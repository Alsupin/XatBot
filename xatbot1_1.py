# -*- coding: utf-8 -*-
"""xatbot1.1

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/12eFdqWWPxtRjUfcuMvHcyySBkWvW5RuX
"""



# Instal路lar les biblioteques necessries
!pip install -U google-genai requests beautifulsoup4

import requests
from bs4 import BeautifulSoup
from google import genai
from google.colab import userdata

# ==============================
# CONFIGURACI DE L'API
# ==============================
# Obtenir la clau API des del Colab
GOOGLE_API_KEY = userdata.get("GOOGLE_API_KEY")
if not GOOGLE_API_KEY:
    print("锔 No s'ha trobat la clau API. Configura-la a Colab abans d'executar el programa.")
    exit()

# Crear el client de GenAI amb la clau API
client = genai.Client(api_key=GOOGLE_API_KEY)

# ==============================
# WEB SCRAPING DE LA URL
# ==============================
# URL de la pgina web a analitzar (canvia-la per la teva URL)
url = "https://alozano.inscastellbisbal.net/"

def obtenir_contingut(url):
    try:
        resposta = requests.get(url)
        if resposta.status_code == 200:
            # Processar el contingut HTML amb BeautifulSoup
            soup = BeautifulSoup(resposta.text, 'html.parser')
            # Extreure tots els pargrafs
            paragrafs = soup.find_all('p')
            # Unir el text de cada pargraf
            contingut = "\n".join([p.get_text() for p in paragrafs])
            return contingut
        else:
            return f"Error: Codi d'estat {resposta.status_code}"
    except Exception as e:
        return f"Error en obtenir el contingut: {e}"

# Obtenir el contingut de la pgina web
contingut_web = obtenir_contingut(url)
print("Contingut extret de la URL:\n", contingut_web[:500], "...\n")  # Mostra els primers 500 carcters

# ==============================
# INSTRUCCIONS DEL SISTEMA
# ==============================
# Afegir al sistema la informaci贸 del contingut web
system_instruction = f"""
Ets un assistent d'intel路lig猫ncia artificial dissenyat per ajudar els usuaris de manera clara, precisa i educada.
Has llegit i analitzat el seg眉ent contingut d'una pgina web:
{contingut_web[:1000]}  # Nom茅s s'afegeixen els primers 1000 carcters per evitar excedir el l铆mit de tokens.
Proporciona respostes concretes i senzilles relacionades amb aquesta pgina web.
"""

# Crear la sessi贸 de xat amb el model
chat = client.chats.create(
    model="gemini-2.0-flash",
    config=genai.types.GenerateContentConfig(
        system_instruction=system_instruction,
        temperature=0.7,
        max_output_tokens=200
    )
)

# ==============================
# BUCLE DEL XAT
# ==============================
print("\n XatBot activat! Escriu 'sortir' per acabar la conversa.\n")

while True:
    try:
        # Llegir la pregunta de l'usuari
        prompt = input(" Usuari: ").strip()
        # Comprovar si l'usuari vol sortir
        if prompt.lower() == "sortir":
            print(" XatBot: Fins aviat!")
            break

        # Combinar el prompt amb la refer猫ncia al contingut web si es desitja
        prompt_complet = f"Tenint en compte el contingut de la pgina web, {prompt}"

        # Enviar el missatge al model i obtenir la resposta
        resposta = chat.send_message(prompt_complet)
        print(f" XatBot: {resposta.text.strip()}\n")
    except Exception as e:
        # Gestionar errors de comunicaci贸 amb l'API
        print(f"锔 Error en la comunicaci贸 amb Gemini: {e}")

# ==============================
# FI DE LA SESSI
# ==============================